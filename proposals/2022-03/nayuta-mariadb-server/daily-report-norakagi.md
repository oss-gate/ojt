---
layout: page
title: 日報 - norioakagi
---
## 2022-04-04

### やったこと
  
  * 栁澤さんのブログの事前準備をこなす
    * https://nayuta-yanagisawa.hatenablog.com/entry/debugging-mysql-mariadb-1
    * https://nayuta-yanagisawa.hatenablog.com/entry/debugging-mysql-mariadb-2
  * 最新（と思われる）10.9でビルドが通らなかったのでブログと同じ10.5にバージョンを戻して実行、エラー出なかったのでそのまま続行 
  
### よかったこと

  * 必要な事前準備が記事でまとまっているとオフラインでも進められるのでそこはよかったです

### 気になったこと

　* 特になし

### こうすればもっとよくなるかも

  * 特になし 

### その他

  * 特になし

### 日報の使用時間

3分

## 202-04-05

### やったこと

  * 栁澤さんのブログの事前準備をこなす
    * https://nayuta-yanagisawa.hatenablog.com/entry/debugging-mysql-mariadb-3
  * ブレークポイントがHitしなかったのでしばらくハマる. `mysql_execute_command` はヒットするので大筋の手順は間違ってないだろうということで終了

### よかったこと

* 特になし

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 202-04-06

### やったこと

  * License AgreementのためPRを出す必要があるので, [MDEV-28226](https://jira.mariadb.org/browse/MDEV-28226) を選択. コミットは手元で作成したものの最新の10.9ではビルドが通らなかったことを思い出しそこで一旦終了.

### よかったこと

* 特になし

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-07

### やったこと

  * 栁澤さんと週次ミーティング
    * [MDEV-28226](https://jira.mariadb.org/browse/MDEV-28226) についてのコメント, マージまで
    * よく使うビルドコマンドetc共有
    * rrハンズオン

### よかったこと

* ドキュメントにのってないコマンドのパラメータや実コマンドを教えてもらえるのは効率上良い. rrはスムーズに導入できた.

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

5分

## 2022-04-08

### やったこと

  * Dive into InnoDB MVCCのスライドを読んでいた https://nayuta-yanagisawa.hatenablog.com/entry/dive-into-innodb-mvcc

### よかったこと

* 他の一般的なMySQL/MariaDBでよく使う機能についても同じように自分でまとめていけると良いなと感じた

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-09, 2022-04-10 

風邪でダウン..

## 2022-04-11

### やったこと

  * [MDEV-28225](https://jira.mariadb.org/browse/MDEV-28225) を少し見る
  * spd_table.ccあたりのコードを読んでいた

### よかったこと

* 特になし

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-12

### やったこと

  * [MDEV-28225](https://jira.mariadb.org/browse/MDEV-28225) が他の人にResolveされたのでタスクが[MDEV-28297](https://jira.mariadb.org/browse/MDEV-28297)に変更.
  * 親タスク[MDEV-27228](https://jira.mariadb.org/browse/MDEV-27228)と他の子タスクの変更コードを読んでいた

### よかったこと

* 特になし

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-13

### やったこと

  * [MDEV-28297](https://jira.mariadb.org/browse/MDEV-28297) の実装とPR
  * git worktree間のブランチの管理でハマって時間をロスする..


### よかったこと

* 特になし

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-14

### やったこと

  * 週ごとのミーティング
    * [MDEV-28297](https://jira.mariadb.org/browse/MDEV-28297) のPRのレビュー
    * 柳澤さんによるデバッグのデモ
      * InnoDB系でとっつきやすいタスクがあまり無いのではないかという話をして, 当初計画を変更してInnoDBに限らずできそうなタスクを見ていくことに

### よかったこと

* デモは流れが掴めるのでよかった

### 気になったこと

* やはりオープンソースプロジェクトは手頃なタスクを見つけていくのがなかなか難しい印象

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-15, 2022-04-16
週末は時間が取れず

## 2022-04-17

### やったこと
https://jira.mariadb.org/browse/MDEV-27313
を見始める. デバッグビルドとテストで再現, コードを追うところまで.


### よかったこと

特になし

### 気になったこと

特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-18

### やったこと
https://jira.mariadb.org/browse/MDEV-27313
の解析続き. m_last_partがおかしくなっている(正常系であれば1のところが0で上書きされている)のでどこで上書きされているのかを追う. 結局ピンポイントで特定はできず.

### よかったこと

特になし

### 気になったこと

特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-19, 20

仕事が忙しくなり手をだせず

## 2022-04-21

### やったこと
https://jira.mariadb.org/browse/MDEV-27313
の解析続き.  ALTER TABLEの処理でfile->refが書き変わってしまっているようではあるがまだ特定できず..

### よかったこと

特になし

### 気になったこと

コードベースが大きくて1つの処理を追うのもなかなか大変であることを感じはじめた

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-22

### やったこと
https://jira.mariadb.org/browse/MDEV-27313
の解析続き. NOT NULLのときだけ問題が再現することに気づいたのでNOT NULLがないときとの違いを追うために  
https://github.com/MariaDB/server/blob/6cb6ba8b7bd61c99e6122b7ab547f5f297b0fc1b/storage/innobase/row/row0merge.cc#L2351-L2354
あたりを重点的に読んでいた.

### よかったこと

特になし

### 気になったこと

特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-23

### やったこと
https://jira.mariadb.org/browse/MDEV-27313
の解析続き. 同じく 
https://github.com/MariaDB/server/blob/6cb6ba8b7bd61c99e6122b7ab547f5f297b0fc1b/storage/innobase/row/row0merge.cc#L2351-L2354
あたりを読んでいたがtableのリファレンスを触っていそうな箇所がわからず行き詰まる

### よかったこと

特になし

### 気になったこと

特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-04-24
時間が取れず

## 2022-04-25

### やったこと

  * 週ごとのミーティング
    * https://jira.mariadb.org/browse/MDEV-27313 はかなり手こずりそうなので一旦保留に
    * https://jira.mariadb.org/browse/MDEV-28315
      * 10.6で再現できるか確認, しない場合10.5 HEADか10.6のひとつ前で再現しないことを確認
      * rrで何のメモリが足りて無いかを見て割り当てetcまで確認、10.5との差分を見る
    * https://jira.mariadb.org/browse/MDEV-26508
      * rrで解放されているところを見る

### よかったこと

* チケットを探して概要だけ説明してもらうスタイルは効率が良いように感じた

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

5分

## 2022-04-26, 2022-4-27 
仕事が忙しく時間が取れず

## 2022-04-28

### やったこと
  * https://jira.mariadb.org/browse/MDEV-28315 の解析
  * どこでstack overflowになっていたかはrrですぐにわかる
  * 根本的すぎるバグに思えたので柳澤さんと方針の確認
    
### よかったこと
  * rr の便利さを感じた

### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

4分

## 2022-04-29

時間が取れず

## 2022-04-30

### やったこと
  * https://jira.mariadb.org/browse/MDEV-28315 の解析続き
  * 柳澤さんと方針の確認(Twitter). 他の変更方法についても検討してみることに.
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-01

### やったこと
  * https://jira.mariadb.org/browse/MDEV-28315 の解析続き
  * 話し合った他の修正方法を試してみるが他のテストがこけはじめて原因を探っていた
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-02

### やったこと
  * https://jira.mariadb.org/browse/MDEV-28315 の解析続き
  　* 引き続きtest failureの解析, 進捗なし..
　* https://jira.mariadb.org/browse/MDEV-26508, https://jira.mariadb.org/browse/MDEV-25784 も再現できるか確認
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-03, 2022-05-04
仕事が忙しくて時間が取れず

## 2022-05-05

### やったこと
  * https://jira.mariadb.org/browse/MDEV-26508 は Nikitaが作業用ブランチを切ったことに気づき一旦ストップ
  * https://jira.mariadb.org/browse/MDEV-25784 の解析
    * TABLE が NULL のため落ちていることはすぐに気づく
    * NULLで想定通りなのか確認するためにコードを読んでいた
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

4分

## 2022-05-06

### やったこと
  * https://jira.mariadb.org/browse/MDEV-25784 の解析
    * NULLは想定通りのように思えたのでNULLチェックを入れてテストを走らせてみる
      * PASS
    * 空JSONというedge caseなテストだったので, 通常ケースも通るのか見てみたいと思いデータありのJSONテーブルで同じテストを実行
      * FAIL
      * NULLは想定通りではなく, 値が入ってないといけないのではないか？と思い始めコードを読み直していた
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-07

### やったこと
  * https://jira.mariadb.org/browse/MDEV-25784 の解析
    * NULLは想定通りのように思えたのでNULLチェックを入れてテストを走らせてみる
      * PASS
    * 空JSONというedge caseなテストだったので, 通常ケースも通るのか見てみたいと思いデータありのJSONテーブルで同じテストを実行
      * FAIL
      * NULLは想定通りではなく, 値が入ってないといけないのではないか？と思い始めコードを読み直していた
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-08, 2022-05-09
仕事が忙しく時間が取れず

## 2022-05-10
### やったこと
  * https://jira.mariadb.org/browse/MDEV-27892
    * PR の修正
  * 
    
### よかったこと
* 特になし
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分

## 2022-05-11

### やったこと
  * https://jira.mariadb.org/browse/MDEV-28315 
    * 柳澤さんと話し, 根本的に修正しようとすると際限がなくなるので最初の変更に戻してPRを打ち直す方向で決定.
  * https://jira.mariadb.org/browse/MDEV-27892
    * Merged
  * https://jira.mariadb.org/browse/MDEV-25784
    * こちらも根本的に全てを直そうとすると大変になっていきそうなので一旦特定の問題だけ直してJIRAで議論していく方向に
  * 柳澤さんと週次ミーティング
    
### よかったこと
* 今後のチケットの取り組み方で大きいのを一挙に取り組もうとすると沼に落ちていくので小さいのを少しずつ潰していく方針でやっていくことを決めたので, うまくいくと期待したいです
  
### 気になったこと

* 特になし

### こうすればもっとよくなるかも

* 特になし

### その他

* 特になし

### 日報の使用時間

3分